# いけともAIニュース 転送ルールの作り方

m19m.hrts83@gmail.com に届く「注目AIニュース」を **matsuno.estate@gmail.com** に転送し、今の token（matsuno.estate 用）のまま取得・保存できるようにする手順です。

---

## 前提

- **転送元**: m19m.hrts83@gmail.com（いけともさんのニュースが届くアドレス）
- **転送先**: matsuno.estate@gmail.com（パートナーやりとりと同じ。ここ用の token でいけともも取得）
- **対象メール**: 差出人 **ikeda@workstyle-evolution.co.jp**、件名に **「注目AIニュース」** が含まれるメール

---

## 転送の設定について

- **設定画面の「転送」**（転送を無効にする / 受信メールを転送）は、**すべてのメール**を転送するかどうかの設定です。
- **ステップ 2 のフィルタ**は、「注目AIニュース」に一致したメール**だけ**を転送先に送る設定です。
- この2つは別なので、**「転送を無効にする」のままで問題ありません**。フィルタで「転送先: matsuno.estate」を指定していれば、いけともさんのニュースだけが転送されます。
- 「受信メールを転送」を有効にすると**すべてのメール**が転送されてしまうため、いけとも用だけ転送したい場合は **「転送を無効」のまま ＋ フィルタで転送** にしてください。

---

## ステップ 1: 転送先を登録する（初回だけ）

1. ブラウザで **m19m.hrts83@gmail.com** にログインした状態で Gmail を開く。
2. 右上の **歯車アイコン** → **「すべての設定を表示」** をクリック。
3. 上タブの **「転送と POP/IMAP」** をクリック。
4. **「転送先アドレスを追加」** をクリック。
5. 転送先に **matsuno.estate@gmail.com** を入力 → **「次へ」** → **「転送を有効にする」**（確認ダイアログで OK）。
6. **matsuno.estate@gmail.com** の受信トレイを開き、Gmail から届いた **確認メール** を開く。
7. メール内の **確認リンク** をクリックする。
8. 画面の指示どおり「転送が有効になりました」などと表示されれば OK。  
   （必要なら m19m の Gmail 設定に戻り、「転送先アドレス」に matsuno.estate が追加されていることを確認。）

---

## ステップ 2: 「注目AIニュース」だけ転送するフィルタを作る

1. もう一度 **m19m.hrts83@gmail.com** で Gmail を開いた状態にする。
2. 検索ボックス右の **▼** をクリックして **詳細検索** を開く。
3. 次のように入力する：
   - **差出人**: `ikeda@workstyle-evolution.co.jp`
   - **件名**: `注目AIニュース`
4. 一番下の **「フィルタを作成」** をクリック。
5. 表示された画面で次を設定する：
   - **「転送先: matsuno.estate@gmail.com」** にチェックを入れる。
   - （任意）「受信トレイをスキップ（アーカイブする）」にチェックを入れると、m19m の受信トレイには残らず、転送だけされる。
6. **「フィルタを作成」** をクリックして保存する。

これで、今後 m19m に届く「注目AIニュース」は自動で matsuno.estate に転送されます。

---

## ステップ 3: 動作確認

1. **matsuno.estate@gmail.com** で Gmail を開く。
2. 転送が有効になっていれば、次回いけともさんから届く「注目AIニュース」が、数秒〜数十秒以内に届く。
3. 既に届いている 2月22日分などは **転送されない**（フィルタは「これから届くメール」にだけかかるため）。  
   - 2月22日分を 05_knowledge に保存したい場合は、**m19m の受信トレイでそのメールを開き、手動で「転送」** して matsuno.estate に送るか、  
   - または **1通だけ** m19m で「注目AIニュース」のメールを選択 → **「転送」** で matsuno.estate に送信すると、matsuno 側でスクリプトが取得対象にできる。

---

## 既に届いた分を手動転送して保存したい場合（エラー発生時のフォールバック）

転送ルールは「これから届くメール」にしかかかりません。すでに m19m に届いているが保存されていない週がある場合（例: GitHub Actions が失敗した週）は、次の手順で保存できます。

1. **m19m の Gmail** で該当の「注目AIニュース」メールを開く → **転送** で **matsuno.estate@gmail.com** に送る。
2. 転送されたメールは **差出人が「自分」** になるため、通常の `--date` だけでは検索にヒットしません。
3. 手元で次を実行する（**転送された日付**で検索。届いた日が 2月23日なら `--date 2026-02-23`）:
   ```bash
   cd "03_outputs/ai_news_save"
   # 215 の venv で実行。日付は転送が届いた日（メールの Date ヘッダー）に合わせる
   /path/to/215/.../.venv_gmail/bin/python gmail_ai_news_save.py --date 2026-02-23 --allow-forwarded
   ```
4. **`--allow-forwarded`** を付けると、差出人不問で「件名に『注目AIニュース』を含むメール」を検索するため、手動転送した1通も取得・保存されます。保存先は「その日が含まれる週」の日付フォルダ（例: 20260222）になります。

---

## まとめ

| 項目 | 内容 |
|------|------|
| 転送元 | m19m.hrts83@gmail.com |
| 転送先 | matsuno.estate@gmail.com |
| 条件 | 差出人: ikeda@workstyle-evolution.co.jp、件名: 注目AIニュース |
| 設定場所 | m19m の Gmail「設定」→「転送と POP/IMAP」＋「フィルタ」 |
| パートナーとのやりとり | matsuno.estate のまま。変更なし。 |

この転送が有効になれば、いけとも用の取得・保存は今の **matsuno.estate 用 token** のままで動きます。
